
**CLEAN, END-TO-END API FLOW** to test **Rating system in Postman**.

Iâ€™ll assume:

* JWT auth is working
* Booking is already **COMPLETED**
* You already have `USER`, `WORKER`, `ADMIN`

---

# ğŸ” COMPLETE RATING API FLOW (POSTMAN)

---

## ğŸŸ¢ STEP 0: PREREQUISITES (VERY IMPORTANT)

### Booking must be:

```json
{
  "_id": "65f1a9b123abc456def78901",
  "status": "COMPLETED",
  "customerId": "USER_ID",
  "workerId": "WORKER_ID"
}
```

âš ï¸ If booking is `PENDING / CANCELLED` â†’ rating will FAIL.

---

# ğŸŸ© FLOW 1: USER RATES WEBSITE

### ğŸ”¹ API

```
POST /ratings
```

### ğŸ”¹ Headers

```
Authorization: Bearer USER_JWT_TOKEN
Content-Type: application/json
```

### ğŸ”¹ Body

```json
{
  "bookingId": "65f1a9b123abc456def78901",
  "rating": 4,
  "review": "Website experience was smooth and easy"
}
```

### âœ… Expected Response

```json
{
  "_id": "660abc1234def56789011122",
  "bookingId": "65f1a9b123abc456def78901",
  "customerId": "USER_ID",
  "workerId": null,
  "rating": 4,
  "review": "Website experience was smooth and easy",
  "createdAt": "...",
  "updatedAt": "..."
}
```

---

# ğŸŸ© FLOW 2: USER RATES WORKER

### ğŸ”¹ API

```
POST /ratings/worker/WORKER_ID
```

### ğŸ”¹ Headers

```
Authorization: Bearer USER_JWT_TOKEN
Content-Type: application/json
```

### ğŸ”¹ Body

```json
{
  "bookingId": "65f1a9b123abc456def78901",
  "rating": 5,
  "review": "Worker arrived on time and fixed everything"
}
```

### âœ… Expected Response

```json
{
  "_id": "660bbb4567abc89011122233",
  "bookingId": "65f1a9b123abc456def78901",
  "customerId": "USER_ID",
  "workerId": "WORKER_ID",
  "rating": 5,
  "review": "Worker arrived on time and fixed everything"
}
```

---

# ğŸŸ© FLOW 3: PREVENT DUPLICATE RATING (AUTO CHECK)

### ğŸ”¹ Try again with same bookingId

```json
{
  "bookingId": "65f1a9b123abc456def78901",
  "rating": 3
}
```

### âŒ Response

```json
{
  "message": "You have already rated this booking"
}
```

---

# ğŸŸ© FLOW 4: USER VIEWS WORKER RATINGS

### ğŸ”¹ API

```
GET /ratings/worker/WORKER_ID
```

### ğŸ”¹ Headers

```
Authorization: Bearer USER_JWT_TOKEN
```

### âœ… Response

```json
[
  {
    "rating": 5,
    "review": "Worker arrived on time and fixed everything",
    "customerId": { "name": "Amit Sharma" }
  }
]
```

---

# ğŸŸ© FLOW 5: WORKER VIEWS OWN RATINGS

### ğŸ”¹ API

```
GET /ratings/worker/WORKER_ID
```

### ğŸ”¹ Headers

```
Authorization: Bearer WORKER_JWT_TOKEN
```

âœ… Allowed

---

# ğŸŸ¥ FLOW 6: WORKER TRIES TO VIEW OTHER WORKER RATINGS

### âŒ Forbidden

```json
{
  "message": "Access denied to other workers' ratings"
}
```

---

# ğŸŸ© FLOW 7: USER UPDATES OWN RATING

### ğŸ”¹ API

```
PUT /ratings/RATING_ID
```

### ğŸ”¹ Headers

```
Authorization: Bearer USER_JWT_TOKEN
```

### ğŸ”¹ Body

```json
{
  "rating": 4,
  "review": "Updated after follow-up service"
}
```

---

# ğŸŸ¥ FLOW 8: USER TRIES TO DELETE RATING

### âŒ Forbidden

```json
{
  "message": "Access denied"
}
```

---

# ğŸŸ© FLOW 9: ADMIN GETS ALL RATINGS

### ğŸ”¹ API

```
GET /ratings
```

### ğŸ”¹ Headers

```
Authorization: Bearer ADMIN_JWT_TOKEN
```

---

# ğŸŸ© FLOW 10: ADMIN DELETES A RATING

### ğŸ”¹ API

```
DELETE /ratings/RATING_ID
```

### ğŸ”¹ Headers

```
Authorization: Bearer ADMIN_JWT_TOKEN
```

### âœ… Response

```json
{
  "message": "Rating deleted successfully"
}
```

---

# ğŸ FINAL SYSTEM CHECKLIST

âœ” Booking ownership verified
âœ” One rating per booking
âœ” Role-based access enforced
âœ” Secure ID handling
âœ” Real-world behavior


